/*
 * -------------------------------------------------
 *  Nextflow config file for running on JAX's Sumner HPC
 * -------------------------------------------------
 * Base config needed for running with -profile sumner
 */

process {
  executor = 'slurm'
  beforeScript = 'module load singularity'
}
singularity {
  enabled = true
  cacheDir = "$HOME/.singularity_cache"
  autoMounts = true
}

process {
    errorStrategy = { task.exitStatus in [143,137,104,134,139] ? 'retry' : 'terminate' }
    maxRetries = 1
    maxErrors = '-1'
    container  = 'gcr.io/nextflow-250616/splicing-pipelines-nf:2.0'

    withName: 'fastqc' {
        cpus = 4
        memory = 10.GB 
    }
    withName: 'trimmomatic' {
        cpus = 8
        memory = 20.GB
    }
    withName: 'fastqc_trimmed' {
        cpus = 4
        memory = 10.GB 
    }
    withName: 'star' {
        cpus = 24
        memory = 60.GB
    }
    withName: 'stringtie' {
        cpus = 8
        memory = 30.GB
    }
    withName: 'stringtie_merge' {
        cpus = 8
        memory = 30.GB
        container = 'gcr.io/nextflow-250616/splicing-pipelines-nf:bioconductor'
    }
    withName: 'prep_de' {
        cpus = 8
        memory = 30.GB
        container = 'gcr.io/nextflow-250616/splicing-pipelines-nf:bioconductor'
    }
    withName: 'rmats' {
        cpus = 16
        memory = 60.GB
        container = 'gcr.io/nextflow-250616/rmats:bioconductor'
    }
    withName: 'paired_rmats' {
        cpus = 16
        memory = 60.GB
        container = 'gcr.io/nextflow-250616/rmats:bioconductor'
    }
    withName: 'multiqc' {
        cpus = 8
        memory = 15.GB
    }
}
